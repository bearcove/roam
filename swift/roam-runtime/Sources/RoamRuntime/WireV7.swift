// @generated by roam-codegen
// DO NOT EDIT — regenerate with `cargo xtask codegen --swift-wire`

import Foundation

public enum WireV7Error: Error, Equatable {
    case truncated
    case unknownVariant(UInt64)
    case overflow
    case invalidUtf8
    case trailingBytes
}

public struct OpaquePayloadV7: Sendable, Equatable {
    public var bytes: [UInt8]

    public init(_ bytes: [UInt8]) {
        self.bytes = bytes
    }

    func encode() -> [UInt8] {
        encodeBytes(bytes)
    }

    static func decode(from data: Data, offset: inout Int) throws -> Self {
        .init(Array(try decodeBytesV7(from: data, offset: &offset)))
    }

    /// Encode without a length prefix — for trailing fields only.
    func encodeTrailing() -> [UInt8] {
        bytes
    }

    /// Decode by consuming all remaining bytes — for trailing fields only.
    static func decodeTrailing(from data: Data, offset: inout Int) -> Self {
        let start = data.startIndex + offset
        let remaining = Array(data[start...])
        offset = data.count
        return .init(remaining)
    }
}

@inline(__always)
private func decodeVarintU32V7(from data: Data, offset: inout Int) throws -> UInt32 {
    let value = try decodeVarint(from: data, offset: &offset)
    guard value <= UInt64(UInt32.max) else {
        throw WireV7Error.overflow
    }
    return UInt32(value)
}

@inline(__always)
private func decodeStringV7(from data: Data, offset: inout Int) throws -> String {
    do {
        return try decodeString(from: data, offset: &offset)
    } catch PostcardError.invalidUtf8 {
        throw WireV7Error.invalidUtf8
    } catch PostcardError.truncated {
        throw WireV7Error.truncated
    } catch {
        throw error
    }
}

@inline(__always)
private func decodeBytesV7(from data: Data, offset: inout Int) throws -> Data {
    do {
        return try decodeBytes(from: data, offset: &offset)
    } catch PostcardError.truncated {
        throw WireV7Error.truncated
    } catch {
        throw error
    }
}

public typealias MetadataV7 = [MetadataEntryV7]

public enum ParityV7: Sendable, Equatable {
    case odd
    case even

    func encode() -> [UInt8] {
        switch self {
        case .odd:
            return encodeVarint(UInt64(0))
        case .even:
            return encodeVarint(UInt64(1))
        }
    }

    static func decode(from data: Data, offset: inout Int) throws -> Self {
        let disc = try decodeVarint(from: data, offset: &offset)
        switch disc {
        case 0:
            return .odd
        case 1:
            return .even
        default:
            throw WireV7Error.unknownVariant(disc)
        }
    }
}

public struct ConnectionSettingsV7: Sendable, Equatable {
    public var parity: ParityV7
    public var maxConcurrentRequests: UInt32

    public init(parity: ParityV7, maxConcurrentRequests: UInt32) {
        self.parity = parity
        self.maxConcurrentRequests = maxConcurrentRequests
    }

    func encode() -> [UInt8] {
        var out: [UInt8] = []
        out += parity.encode()
        out += encodeVarint(UInt64(maxConcurrentRequests))
        return out
    }

    static func decode(from data: Data, offset: inout Int) throws -> Self {
        let parity = try ParityV7.decode(from: data, offset: &offset)
        let maxConcurrentRequests = try decodeVarintU32V7(from: data, offset: &offset)
        return .init(parity: parity, maxConcurrentRequests: maxConcurrentRequests)
    }
}

public enum MetadataValueV7: Sendable, Equatable {
    case string(String)
    case bytes([UInt8])
    case u64(UInt64)

    func encode() -> [UInt8] {
        switch self {
        case .string(let val):
            return encodeVarint(UInt64(0)) + encodeString(val)
        case .bytes(let val):
            return encodeVarint(UInt64(1)) + encodeBytes(val)
        case .u64(let val):
            return encodeVarint(UInt64(2)) + encodeVarint(val)
        }
    }

    static func decode(from data: Data, offset: inout Int) throws -> Self {
        let disc = try decodeVarint(from: data, offset: &offset)
        switch disc {
        case 0:
            return .string(try decodeStringV7(from: data, offset: &offset))
        case 1:
            return .bytes(Array(try decodeBytesV7(from: data, offset: &offset)))
        case 2:
            return .u64(try decodeVarint(from: data, offset: &offset))
        default:
            throw WireV7Error.unknownVariant(disc)
        }
    }
}

public struct MetadataEntryV7: Sendable, Equatable {
    public var key: String
    public var value: MetadataValueV7
    public var flags: UInt64

    public init(key: String, value: MetadataValueV7, flags: UInt64) {
        self.key = key
        self.value = value
        self.flags = flags
    }

    func encode() -> [UInt8] {
        var out: [UInt8] = []
        out += encodeString(key)
        out += value.encode()
        out += encodeVarint(flags)
        return out
    }

    static func decode(from data: Data, offset: inout Int) throws -> Self {
        let key = try decodeStringV7(from: data, offset: &offset)
        let value = try MetadataValueV7.decode(from: data, offset: &offset)
        let flags = try decodeVarint(from: data, offset: &offset)
        return .init(key: key, value: value, flags: flags)
    }
}

public struct HelloV7: Sendable, Equatable {
    public var version: UInt32
    public var connectionSettings: ConnectionSettingsV7
    public var metadata: [MetadataEntryV7]

    public init(version: UInt32, connectionSettings: ConnectionSettingsV7, metadata: [MetadataEntryV7]) {
        self.version = version
        self.connectionSettings = connectionSettings
        self.metadata = metadata
    }

    func encode() -> [UInt8] {
        var out: [UInt8] = []
        out += encodeVarint(UInt64(version))
        out += connectionSettings.encode()
        out += encodeVec(metadata, encoder: { $0.encode() })
        return out
    }

    static func decode(from data: Data, offset: inout Int) throws -> Self {
        let version = try decodeVarintU32V7(from: data, offset: &offset)
        let connectionSettings = try ConnectionSettingsV7.decode(from: data, offset: &offset)
        let metadata = try decodeVec(from: data, offset: &offset, decoder: { data, off in try MetadataEntryV7.decode(from: data, offset: &off) })
        return .init(version: version, connectionSettings: connectionSettings, metadata: metadata)
    }
}

public struct HelloYourselfV7: Sendable, Equatable {
    public var connectionSettings: ConnectionSettingsV7
    public var metadata: [MetadataEntryV7]

    public init(connectionSettings: ConnectionSettingsV7, metadata: [MetadataEntryV7]) {
        self.connectionSettings = connectionSettings
        self.metadata = metadata
    }

    func encode() -> [UInt8] {
        var out: [UInt8] = []
        out += connectionSettings.encode()
        out += encodeVec(metadata, encoder: { $0.encode() })
        return out
    }

    static func decode(from data: Data, offset: inout Int) throws -> Self {
        let connectionSettings = try ConnectionSettingsV7.decode(from: data, offset: &offset)
        let metadata = try decodeVec(from: data, offset: &offset, decoder: { data, off in try MetadataEntryV7.decode(from: data, offset: &off) })
        return .init(connectionSettings: connectionSettings, metadata: metadata)
    }
}

public struct ProtocolErrorV7: Sendable, Equatable {
    public var description: String

    public init(description: String) {
        self.description = description
    }

    func encode() -> [UInt8] {
        encodeString(description)
    }

    static func decode(from data: Data, offset: inout Int) throws -> Self {
        let description = try decodeStringV7(from: data, offset: &offset)
        return .init(description: description)
    }
}

public struct ConnectionOpenV7: Sendable, Equatable {
    public var connectionSettings: ConnectionSettingsV7
    public var metadata: [MetadataEntryV7]

    public init(connectionSettings: ConnectionSettingsV7, metadata: [MetadataEntryV7]) {
        self.connectionSettings = connectionSettings
        self.metadata = metadata
    }

    func encode() -> [UInt8] {
        var out: [UInt8] = []
        out += connectionSettings.encode()
        out += encodeVec(metadata, encoder: { $0.encode() })
        return out
    }

    static func decode(from data: Data, offset: inout Int) throws -> Self {
        let connectionSettings = try ConnectionSettingsV7.decode(from: data, offset: &offset)
        let metadata = try decodeVec(from: data, offset: &offset, decoder: { data, off in try MetadataEntryV7.decode(from: data, offset: &off) })
        return .init(connectionSettings: connectionSettings, metadata: metadata)
    }
}

public struct ConnectionAcceptV7: Sendable, Equatable {
    public var connectionSettings: ConnectionSettingsV7
    public var metadata: [MetadataEntryV7]

    public init(connectionSettings: ConnectionSettingsV7, metadata: [MetadataEntryV7]) {
        self.connectionSettings = connectionSettings
        self.metadata = metadata
    }

    func encode() -> [UInt8] {
        var out: [UInt8] = []
        out += connectionSettings.encode()
        out += encodeVec(metadata, encoder: { $0.encode() })
        return out
    }

    static func decode(from data: Data, offset: inout Int) throws -> Self {
        let connectionSettings = try ConnectionSettingsV7.decode(from: data, offset: &offset)
        let metadata = try decodeVec(from: data, offset: &offset, decoder: { data, off in try MetadataEntryV7.decode(from: data, offset: &off) })
        return .init(connectionSettings: connectionSettings, metadata: metadata)
    }
}

public struct ConnectionRejectV7: Sendable, Equatable {
    public var metadata: [MetadataEntryV7]

    public init(metadata: [MetadataEntryV7]) {
        self.metadata = metadata
    }

    func encode() -> [UInt8] {
        encodeVec(metadata, encoder: { $0.encode() })
    }

    static func decode(from data: Data, offset: inout Int) throws -> Self {
        let metadata = try decodeVec(from: data, offset: &offset, decoder: { data, off in try MetadataEntryV7.decode(from: data, offset: &off) })
        return .init(metadata: metadata)
    }
}

public struct ConnectionCloseV7: Sendable, Equatable {
    public var metadata: [MetadataEntryV7]

    public init(metadata: [MetadataEntryV7]) {
        self.metadata = metadata
    }

    func encode() -> [UInt8] {
        encodeVec(metadata, encoder: { $0.encode() })
    }

    static func decode(from data: Data, offset: inout Int) throws -> Self {
        let metadata = try decodeVec(from: data, offset: &offset, decoder: { data, off in try MetadataEntryV7.decode(from: data, offset: &off) })
        return .init(metadata: metadata)
    }
}

public struct RequestCallV7: Sendable, Equatable {
    public var methodId: UInt64
    public var channels: [UInt64]
    public var metadata: [MetadataEntryV7]
    public var args: OpaquePayloadV7

    public init(methodId: UInt64, channels: [UInt64], metadata: [MetadataEntryV7], args: OpaquePayloadV7) {
        self.methodId = methodId
        self.channels = channels
        self.metadata = metadata
        self.args = args
    }

    func encode() -> [UInt8] {
        var out: [UInt8] = []
        out += encodeVarint(methodId)
        out += encodeVec(channels, encoder: { encodeVarint($0) })
        out += encodeVec(metadata, encoder: { $0.encode() })
        out += args.encodeTrailing()
        return out
    }

    static func decode(from data: Data, offset: inout Int) throws -> Self {
        let methodId = try decodeVarint(from: data, offset: &offset)
        let channels = try decodeVec(from: data, offset: &offset, decoder: { data, off in try decodeVarint(from: data, offset: &off) })
        let metadata = try decodeVec(from: data, offset: &offset, decoder: { data, off in try MetadataEntryV7.decode(from: data, offset: &off) })
        let args = OpaquePayloadV7.decodeTrailing(from: data, offset: &offset)
        return .init(methodId: methodId, channels: channels, metadata: metadata, args: args)
    }
}

public struct RequestResponseV7: Sendable, Equatable {
    public var channels: [UInt64]
    public var metadata: [MetadataEntryV7]
    public var ret: OpaquePayloadV7

    public init(channels: [UInt64], metadata: [MetadataEntryV7], ret: OpaquePayloadV7) {
        self.channels = channels
        self.metadata = metadata
        self.ret = ret
    }

    func encode() -> [UInt8] {
        var out: [UInt8] = []
        out += encodeVec(channels, encoder: { encodeVarint($0) })
        out += encodeVec(metadata, encoder: { $0.encode() })
        out += ret.encodeTrailing()
        return out
    }

    static func decode(from data: Data, offset: inout Int) throws -> Self {
        let channels = try decodeVec(from: data, offset: &offset, decoder: { data, off in try decodeVarint(from: data, offset: &off) })
        let metadata = try decodeVec(from: data, offset: &offset, decoder: { data, off in try MetadataEntryV7.decode(from: data, offset: &off) })
        let ret = OpaquePayloadV7.decodeTrailing(from: data, offset: &offset)
        return .init(channels: channels, metadata: metadata, ret: ret)
    }
}

public struct RequestCancelV7: Sendable, Equatable {
    public var metadata: [MetadataEntryV7]

    public init(metadata: [MetadataEntryV7]) {
        self.metadata = metadata
    }

    func encode() -> [UInt8] {
        encodeVec(metadata, encoder: { $0.encode() })
    }

    static func decode(from data: Data, offset: inout Int) throws -> Self {
        let metadata = try decodeVec(from: data, offset: &offset, decoder: { data, off in try MetadataEntryV7.decode(from: data, offset: &off) })
        return .init(metadata: metadata)
    }
}

public enum RequestBodyV7: Sendable, Equatable {
    case call(RequestCallV7)
    case response(RequestResponseV7)
    case cancel(RequestCancelV7)

    func encode() -> [UInt8] {
        switch self {
        case .call(let val):
            return encodeVarint(UInt64(0)) + val.encode()
        case .response(let val):
            return encodeVarint(UInt64(1)) + val.encode()
        case .cancel(let val):
            return encodeVarint(UInt64(2)) + val.encode()
        }
    }

    static func decode(from data: Data, offset: inout Int) throws -> Self {
        let disc = try decodeVarint(from: data, offset: &offset)
        switch disc {
        case 0:
            return .call(try RequestCallV7.decode(from: data, offset: &offset))
        case 1:
            return .response(try RequestResponseV7.decode(from: data, offset: &offset))
        case 2:
            return .cancel(try RequestCancelV7.decode(from: data, offset: &offset))
        default:
            throw WireV7Error.unknownVariant(disc)
        }
    }
}

public struct RequestMessageV7: Sendable, Equatable {
    public var id: UInt64
    public var body: RequestBodyV7

    public init(id: UInt64, body: RequestBodyV7) {
        self.id = id
        self.body = body
    }

    func encode() -> [UInt8] {
        var out: [UInt8] = []
        out += encodeVarint(id)
        out += body.encode()
        return out
    }

    static func decode(from data: Data, offset: inout Int) throws -> Self {
        let id = try decodeVarint(from: data, offset: &offset)
        let body = try RequestBodyV7.decode(from: data, offset: &offset)
        return .init(id: id, body: body)
    }
}

public struct ChannelItemV7: Sendable, Equatable {
    public var item: OpaquePayloadV7

    public init(item: OpaquePayloadV7) {
        self.item = item
    }

    func encode() -> [UInt8] {
        item.encodeTrailing()
    }

    static func decode(from data: Data, offset: inout Int) throws -> Self {
        let item = OpaquePayloadV7.decodeTrailing(from: data, offset: &offset)
        return .init(item: item)
    }
}

public struct ChannelCloseV7: Sendable, Equatable {
    public var metadata: [MetadataEntryV7]

    public init(metadata: [MetadataEntryV7]) {
        self.metadata = metadata
    }

    func encode() -> [UInt8] {
        encodeVec(metadata, encoder: { $0.encode() })
    }

    static func decode(from data: Data, offset: inout Int) throws -> Self {
        let metadata = try decodeVec(from: data, offset: &offset, decoder: { data, off in try MetadataEntryV7.decode(from: data, offset: &off) })
        return .init(metadata: metadata)
    }
}

public struct ChannelResetV7: Sendable, Equatable {
    public var metadata: [MetadataEntryV7]

    public init(metadata: [MetadataEntryV7]) {
        self.metadata = metadata
    }

    func encode() -> [UInt8] {
        encodeVec(metadata, encoder: { $0.encode() })
    }

    static func decode(from data: Data, offset: inout Int) throws -> Self {
        let metadata = try decodeVec(from: data, offset: &offset, decoder: { data, off in try MetadataEntryV7.decode(from: data, offset: &off) })
        return .init(metadata: metadata)
    }
}

public struct ChannelGrantCreditV7: Sendable, Equatable {
    public var additional: UInt32

    public init(additional: UInt32) {
        self.additional = additional
    }

    func encode() -> [UInt8] {
        encodeVarint(UInt64(additional))
    }

    static func decode(from data: Data, offset: inout Int) throws -> Self {
        let additional = try decodeVarintU32V7(from: data, offset: &offset)
        return .init(additional: additional)
    }
}

public enum ChannelBodyV7: Sendable, Equatable {
    case item(ChannelItemV7)
    case close(ChannelCloseV7)
    case reset(ChannelResetV7)
    case grantCredit(ChannelGrantCreditV7)

    func encode() -> [UInt8] {
        switch self {
        case .item(let val):
            return encodeVarint(UInt64(0)) + val.encode()
        case .close(let val):
            return encodeVarint(UInt64(1)) + val.encode()
        case .reset(let val):
            return encodeVarint(UInt64(2)) + val.encode()
        case .grantCredit(let val):
            return encodeVarint(UInt64(3)) + val.encode()
        }
    }

    static func decode(from data: Data, offset: inout Int) throws -> Self {
        let disc = try decodeVarint(from: data, offset: &offset)
        switch disc {
        case 0:
            return .item(try ChannelItemV7.decode(from: data, offset: &offset))
        case 1:
            return .close(try ChannelCloseV7.decode(from: data, offset: &offset))
        case 2:
            return .reset(try ChannelResetV7.decode(from: data, offset: &offset))
        case 3:
            return .grantCredit(try ChannelGrantCreditV7.decode(from: data, offset: &offset))
        default:
            throw WireV7Error.unknownVariant(disc)
        }
    }
}

public struct ChannelMessageV7: Sendable, Equatable {
    public var id: UInt64
    public var body: ChannelBodyV7

    public init(id: UInt64, body: ChannelBodyV7) {
        self.id = id
        self.body = body
    }

    func encode() -> [UInt8] {
        var out: [UInt8] = []
        out += encodeVarint(id)
        out += body.encode()
        return out
    }

    static func decode(from data: Data, offset: inout Int) throws -> Self {
        let id = try decodeVarint(from: data, offset: &offset)
        let body = try ChannelBodyV7.decode(from: data, offset: &offset)
        return .init(id: id, body: body)
    }
}

public enum MessagePayloadV7: Sendable, Equatable {
    case hello(HelloV7)
    case helloYourself(HelloYourselfV7)
    case protocolError(ProtocolErrorV7)
    case connectionOpen(ConnectionOpenV7)
    case connectionAccept(ConnectionAcceptV7)
    case connectionReject(ConnectionRejectV7)
    case connectionClose(ConnectionCloseV7)
    case requestMessage(RequestMessageV7)
    case channelMessage(ChannelMessageV7)

    func encode() -> [UInt8] {
        switch self {
        case .hello(let val):
            return encodeVarint(UInt64(0)) + val.encode()
        case .helloYourself(let val):
            return encodeVarint(UInt64(1)) + val.encode()
        case .protocolError(let val):
            return encodeVarint(UInt64(2)) + val.encode()
        case .connectionOpen(let val):
            return encodeVarint(UInt64(3)) + val.encode()
        case .connectionAccept(let val):
            return encodeVarint(UInt64(4)) + val.encode()
        case .connectionReject(let val):
            return encodeVarint(UInt64(5)) + val.encode()
        case .connectionClose(let val):
            return encodeVarint(UInt64(6)) + val.encode()
        case .requestMessage(let val):
            return encodeVarint(UInt64(7)) + val.encode()
        case .channelMessage(let val):
            return encodeVarint(UInt64(8)) + val.encode()
        }
    }

    static func decode(from data: Data, offset: inout Int) throws -> Self {
        let disc = try decodeVarint(from: data, offset: &offset)
        switch disc {
        case 0:
            return .hello(try HelloV7.decode(from: data, offset: &offset))
        case 1:
            return .helloYourself(try HelloYourselfV7.decode(from: data, offset: &offset))
        case 2:
            return .protocolError(try ProtocolErrorV7.decode(from: data, offset: &offset))
        case 3:
            return .connectionOpen(try ConnectionOpenV7.decode(from: data, offset: &offset))
        case 4:
            return .connectionAccept(try ConnectionAcceptV7.decode(from: data, offset: &offset))
        case 5:
            return .connectionReject(try ConnectionRejectV7.decode(from: data, offset: &offset))
        case 6:
            return .connectionClose(try ConnectionCloseV7.decode(from: data, offset: &offset))
        case 7:
            return .requestMessage(try RequestMessageV7.decode(from: data, offset: &offset))
        case 8:
            return .channelMessage(try ChannelMessageV7.decode(from: data, offset: &offset))
        default:
            throw WireV7Error.unknownVariant(disc)
        }
    }
}

public struct MessageV7: Sendable, Equatable {
    public var connectionId: UInt64
    public var payload: MessagePayloadV7

    public init(connectionId: UInt64, payload: MessagePayloadV7) {
        self.connectionId = connectionId
        self.payload = payload
    }

    public func encode() -> [UInt8] {
        var out: [UInt8] = []
        out += encodeVarint(connectionId)
        out += payload.encode()
        return out
    }

    public static func decode(from data: Data, offset: inout Int) throws -> Self {
        let connectionId = try decodeVarint(from: data, offset: &offset)
        let payload = try MessagePayloadV7.decode(from: data, offset: &offset)
        return .init(connectionId: connectionId, payload: payload)
    }

    public static func decode(from data: Data) throws -> Self {
        var offset = 0
        let result = try decode(from: data, offset: &offset)
        guard offset == data.count else {
            throw WireV7Error.trailingBytes
        }
        return result
    }
}

public extension MessageV7 {
    static func hello(_ value: HelloV7) -> MessageV7 {
        MessageV7(connectionId: 0, payload: .hello(value))
    }

    static func helloYourself(_ value: HelloYourselfV7) -> MessageV7 {
        MessageV7(connectionId: 0, payload: .helloYourself(value))
    }

    static func protocolError(_ value: ProtocolErrorV7) -> MessageV7 {
        MessageV7(connectionId: 0, payload: .protocolError(value))
    }

    static func connectionOpen(connId: UInt64, _ value: ConnectionOpenV7) -> MessageV7 {
        MessageV7(connectionId: connId, payload: .connectionOpen(value))
    }

    static func connectionAccept(connId: UInt64, _ value: ConnectionAcceptV7) -> MessageV7 {
        MessageV7(connectionId: connId, payload: .connectionAccept(value))
    }

    static func connectionReject(connId: UInt64, _ value: ConnectionRejectV7) -> MessageV7 {
        MessageV7(connectionId: connId, payload: .connectionReject(value))
    }

    static func connectionClose(connId: UInt64, _ value: ConnectionCloseV7) -> MessageV7 {
        MessageV7(connectionId: connId, payload: .connectionClose(value))
    }

    static func requestMessage(connId: UInt64, _ value: RequestMessageV7) -> MessageV7 {
        MessageV7(connectionId: connId, payload: .requestMessage(value))
    }

    static func channelMessage(connId: UInt64, _ value: ChannelMessageV7) -> MessageV7 {
        MessageV7(connectionId: connId, payload: .channelMessage(value))
    }

    static func protocolError(description: String) -> MessageV7 {
        MessageV7(connectionId: 0, payload: .protocolError(.init(description: description)))
    }

    static func connectionOpen(connId: UInt64, settings: ConnectionSettingsV7, metadata: [MetadataEntryV7]) -> MessageV7 {
        MessageV7(connectionId: connId, payload: .connectionOpen(.init(connectionSettings: settings, metadata: metadata)))
    }

    static func connectionAccept(connId: UInt64, settings: ConnectionSettingsV7, metadata: [MetadataEntryV7]) -> MessageV7 {
        MessageV7(connectionId: connId, payload: .connectionAccept(.init(connectionSettings: settings, metadata: metadata)))
    }

    static func connectionReject(connId: UInt64, metadata: [MetadataEntryV7]) -> MessageV7 {
        MessageV7(connectionId: connId, payload: .connectionReject(.init(metadata: metadata)))
    }

    static func connectionClose(connId: UInt64, metadata: [MetadataEntryV7]) -> MessageV7 {
        MessageV7(connectionId: connId, payload: .connectionClose(.init(metadata: metadata)))
    }

    static func request(
        connId: UInt64,
        requestId: UInt64,
        methodId: UInt64,
        metadata: [MetadataEntryV7],
        channels: [UInt64],
        payload: [UInt8]
    ) -> MessageV7 {
        MessageV7(
            connectionId: connId,
            payload: .requestMessage(
                .init(
                    id: requestId,
                    body: .call(.init(methodId: methodId, channels: channels, metadata: metadata, args: .init(payload)))
                ))
        )
    }

    static func response(
        connId: UInt64,
        requestId: UInt64,
        metadata: [MetadataEntryV7],
        channels: [UInt64],
        payload: [UInt8]
    ) -> MessageV7 {
        MessageV7(
            connectionId: connId,
            payload: .requestMessage(
                .init(
                    id: requestId,
                    body: .response(.init(channels: channels, metadata: metadata, ret: .init(payload)))
                ))
        )
    }

    static func cancel(connId: UInt64, requestId: UInt64, metadata: [MetadataEntryV7] = []) -> MessageV7 {
        MessageV7(
            connectionId: connId,
            payload: .requestMessage(
                .init(
                    id: requestId,
                    body: .cancel(.init(metadata: metadata))
                ))
        )
    }

    static func data(connId: UInt64, channelId: UInt64, payload: [UInt8]) -> MessageV7 {
        MessageV7(
            connectionId: connId,
            payload: .channelMessage(.init(id: channelId, body: .item(.init(item: .init(payload)))))
        )
    }

    static func close(connId: UInt64, channelId: UInt64, metadata: [MetadataEntryV7] = []) -> MessageV7 {
        MessageV7(
            connectionId: connId,
            payload: .channelMessage(.init(id: channelId, body: .close(.init(metadata: metadata))))
        )
    }

    static func reset(connId: UInt64, channelId: UInt64, metadata: [MetadataEntryV7] = []) -> MessageV7 {
        MessageV7(
            connectionId: connId,
            payload: .channelMessage(.init(id: channelId, body: .reset(.init(metadata: metadata))))
        )
    }

    static func credit(connId: UInt64, channelId: UInt64, bytes: UInt32) -> MessageV7 {
        MessageV7(
            connectionId: connId,
            payload: .channelMessage(.init(id: channelId, body: .grantCredit(.init(additional: bytes))))
        )
    }
}
