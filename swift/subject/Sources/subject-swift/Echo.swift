// @generated by rapace-codegen
// DO NOT EDIT - regenerate with `cargo run -p rapace-codegen`

import Foundation
import RapaceRuntime

public enum EchoMethodId {
    public static let echo: UInt64 = 0x3d66dd9ee36b4240
    public static let reverse: UInt64 = 0x268246d3219503fb
}

///  Simple echo service for conformance testing.
public protocol EchoClient {
    ///  Echoes the message back.
    func echo(message: String) async throws -> String
    ///  Returns the message reversed.
    func reverse(message: String) async throws -> String
}

/// Server handler protocol for Echo
public protocol EchoHandler {
    func echo(message: String) async throws -> String
    func reverse(message: String) async throws -> String
}

public func createEchoDispatcher(handler: any EchoHandler) -> (UInt64, Data) async throws -> Data {
    return { methodId, payload in
        switch methodId {
        case 0x3d66dd9ee36b4240:
            do {
                var offset = 0
                let message = try decodeString(from: payload, offset: &offset)
                let result = try await handler.echo(message: message)
                return Data(encodeResultOk(result, encoder: encodeString))
            } catch {
                return Data(encodeInvalidPayloadError())
            }
        case 0x268246d3219503fb:
            do {
                var offset = 0
                let message = try decodeString(from: payload, offset: &offset)
                let result = try await handler.reverse(message: message)
                return Data(encodeResultOk(result, encoder: encodeString))
            } catch {
                return Data(encodeInvalidPayloadError())
            }
        default:
            return Data(encodeUnknownMethodError())
        }
    }
}
