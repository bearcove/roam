# Enable experimental features
experimental = ["setup-scripts"]

[profile.default]
# Fail fast - stop on first failure
fail-fast = true

# Status level
status-level = "pass"

# Timeout: 10s per attempt, 3 attempts max
slow-timeout = { period = "10s", terminate-after = 3 }

# Note: Rust spec conformance tests are run via `cargo run -p rapace-spec-tests`
# which orchestrates rapace-spec-peer and rapace-spec-subject

# Pre-build helper binaries before running tests
[scripts.setup.build-helpers]
command = "cargo build --bins -p rapace-diagnostics-over-rapace -p rapace-http-over-rapace -p rapace-template-engine -p rapace-tracing-over-rapace -p rapace-spec-peer -p rapace-spec-subject"
slow-timeout = { period = "60s" }

# Apply the build-helpers setup script to spec tests
[[profile.default.scripts]]
filter = 'package(rapace-spec-tests)'
setup = 'build-helpers'

[profile.ci]
# CI profile with longer timeouts for cross-process tests
fail-fast = true
slow-timeout = { period = "30s", terminate-after = 2 }
status-level = "pass"

[[profile.ci.scripts]]
filter = 'package(rapace-spec-tests)'
setup = 'build-helpers'
