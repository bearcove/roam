# Enable experimental features
experimental = ["setup-scripts"]

[scripts.setup.moire-env]
command = ['sh', '-c', 'echo "MOIRE_DASHBOARD=127.0.0.1:9119" >> "$NEXTEST_ENV"']

[profile.loom]
slow-timeout = { period = "10s", terminate-after = 3 }

[profile.patient]
slow-timeout = { period = "30s", terminate-after = 4 }

[profile.coverage]
# Coverage-instrumented binaries are significantly slower, especially over SHM.
slow-timeout = { period = "30s", terminate-after = 8 }
fail-fast = false
status-level = "pass"

[profile.moire]
slow-timeout = { period = "1h", terminate-after = 24 }

[[profile.moire.scripts]]
filter = 'all()'
setup = 'moire-env'

[profile.default]
# Fail fast - stop on first failure
fail-fast = true

# Status level
status-level = "pass"

# Slow test warning threshold
slow-timeout = { period = "2s", terminate-after = 2 }

[[profile.default.overrides]]
# TypeScript TCP conformance tests can exceed the strict 4s default budget on
# smaller CI runners when several cases spin up Node processes concurrently.
filter = 'test(lang_typescript_transport_tcp::)'
slow-timeout = { period = "8s", terminate-after = 3 }
