[workspace]
resolver = "2"
members = [
  "xtask",
  "spec/spec-proto",
  "spec/spec-tests",
  "rust/roam-types",
  "rust/roam-core",
  "rust/roam-hash",
  "rust/roam-stream",
  "rust/roam-websocket",
  "rust/roam-local",
  "rust/roam-fdpass",
  "rust/roam-shm",
  "rust/shm-primitives-async",
  "rust/roam-shm-ffi",
  "rust/roam-macros-parse",
  "rust/roam-macros-core",
  "rust/roam-macros",
  "rust/roam",
  "rust/roam-bench",
  "rust/subject-rust",
  "rust/roam-codegen",
  "rust/wasm-browser-tests",
  "typescript/peer-server",
]
exclude = ["fuzz"]

[workspace.package]
version = "3.0.0"
edition = "2024"
rust-version = "1.91"
license = "MIT OR Apache-2.0"
repository = "https://github.com/bearcove/roam"

[workspace.dependencies]
# Internal crates
roam = { path = "rust/roam", version = "3.0.0" }
roam-types = { path = "rust/roam-types", version = "3.0.0" }
roam-hash = { path = "rust/roam-hash", version = "3.0.0" }
roam-macros-parse = { path = "rust/roam-macros-parse", version = "3.0.0" }
roam-macros-core = { path = "rust/roam-macros-core", version = "3.0.0" }
roam-service-macros = { path = "rust/roam-macros", version = "3.0.0" }
roam-core = { path = "rust/roam-core", version = "3.0.0" }
roam-stream = { path = "rust/roam-stream", version = "3.0.0" }
roam-codegen = { path = "rust/roam-codegen", version = "3.0.0" }
roam-websocket = { path = "rust/roam-websocket", version = "3.0.0" }
shm-primitives = { path = "rust/shm-primitives", version = "3.0.0", default-features = false }
shm-primitives-async = { path = "rust/shm-primitives-async", version = "3.0.0", default-features = false }
ur-taking-me-with-you = { path = "rust/ur-taking-me-with-you", version = "3.0.0" }
moire = { version = "0.1.0", git = "https://github.com/bearcove/moire", branch = "main" }
moire-types = { version = "0.1.0", git = "https://github.com/bearcove/moire", branch = "main" }

bitflags = "2.11.0"
structstruck = "0.5.1"
bytes = "1"
blake3 = "1.8"
heck = "0.5"
tokio = { version = "1", features = ["sync", "rt", "time", "macros", "io-util"] }
tokio-tungstenite = "0.26"
libc = "0.2.180"

# facet ecosystem
facet = { version = "0.43.0", git = "https://github.com/facet-rs/facet", branch = "main", features = [
  "camino",
  "reflect",
] }
facet-core = { version = "0.43.0", git = "https://github.com/facet-rs/facet", branch = "main" }
facet-postcard = { version = "0.43.0", git = "https://github.com/facet-rs/facet", branch = "main", features = [
  "camino",
] }
facet-path = { version = "0.43.0", git = "https://github.com/facet-rs/facet", branch = "main" }
facet-reflect = { version = "0.43.0", git = "https://github.com/facet-rs/facet", branch = "main" }
facet-format = { version = "0.43.0", git = "https://github.com/facet-rs/facet", branch = "main" }
facet-pretty = { version = "0.43.0", git = "https://github.com/facet-rs/facet", branch = "main" }
facet-json = { version = "0.43.0", git = "https://github.com/facet-rs/facet", branch = "main" }
facet-value = { version = "0.43.0", git = "https://github.com/facet-rs/facet", branch = "main" }
facet-testhelpers = { version = "0.43.0", git = "https://github.com/facet-rs/facet", branch = "main" }
facet-cargo-toml = { version = "0.43.0", git = "https://github.com/bearcove/facet-cargo-toml", branch = "main" }

# Futures utilities
futures-util = "0.3"

# WASM support
wasm-bindgen-futures = "0.4"

# Tracing
tracing = "0.1"
tracing-subscriber = { version = "0.3", features = ["env-filter"] }
static_assertions = "1.1.0"
ulid = "1"

smallvec = "1.15.1"
getrandom = { version = "0.3", features = ["wasm_js"] }
zerocopy = { version = "0.8", features = ["derive"] }

# Benchmarking
divan = "0.1"
tarpc = { version = "0.37", features = ["tokio1", "serde1"] }
tonic = "0.14"
prost = "0.14"
tonic-prost = "0.14"
tonic-prost-build = "0.14"
serde = { version = "1", features = ["derive"] }
hyper-util = "0.1"
tower = "0.5"
tokio-stream = "0.1"

# [patch."https://github.com/facet-rs/facet"]
# facet = { path = "../facet/facet" }
# facet-core = { path = "../facet/facet-core" }
# facet-postcard = { path = "../facet/facet-postcard" }
# facet-path = { path = "../facet/facet-path" }
# facet-reflect = { path = "../facet/facet-reflect" }
# facet-format = { path = "../facet/facet-format" }
# facet-pretty = { path = "../facet/facet-pretty" }
# facet-json = { path = "../facet/facet-json" }
# facet-value = { path = "../facet/facet-value" }
# facet-testhelpers = { path = "../facet/facet-testhelpers" }

# # Uncomment to develop moire
# [patch."https://github.com/bearcove/moire"]
# moire = { path = "../moire/crates/moire" }
# moire-types = { path = "../moire/crates/moire-types" }

[profile.release]
debug = 1

[profile.samply]
inherits = "release"
debug = true
