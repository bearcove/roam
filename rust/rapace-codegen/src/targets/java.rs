use rapace_schema::MethodDetail;

use crate::render::{fq_name, hex_u64};

pub fn generate_method_ids(methods: &[MethodDetail]) -> String {
    let mut items = methods
        .iter()
        .map(|m| (fq_name(m), crate::method_id(m)))
        .collect::<Vec<_>>();
    items.sort_by(|a, b| a.0.cmp(&b.0));

    let mut out = String::new();
    out.push_str("// Code generated by rapace-codegen. DO NOT EDIT.\n\n");
    out.push_str("import java.util.Map;\n\n");
    out.push_str("public final class RapaceMethodId {\n");
    out.push_str("    private RapaceMethodId() {}\n\n");
    out.push_str("    public static final Map<String, Long> BY_NAME = Map.ofEntries(\n");
    for (i, (name, id)) in items.iter().enumerate() {
        let comma = if i + 1 == items.len() { "" } else { "," };
        out.push_str(&format!(
            "        Map.entry(\"{name}\", {hex}L){comma}\n",
            hex = hex_u64(*id)
        ));
    }
    out.push_str("    );\n");
    out.push_str("}\n");
    out
}

